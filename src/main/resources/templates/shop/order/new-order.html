<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="layout/default">
<th:layout layout:fragment="main">
	<script>
		var header = $("meta[name='_csrf_header']").attr("content");
		var token  = $("meta[name='_csrf']").attr("content");
	</script>
	<script th:inline="javascript">

		var orderObj = {

			getOrderList : function(obj) {

				var userId = [[${session.user.getId()}]],
						page = obj ? $(obj).data("page") : 1;

				$.ajax({
					type : "GET",
					url  : "/user/" + userId + "/order/" + page,
					contentType : "application/json",
					beforeSend	: function(xhr) {
						xhr.setRequestHeader(header, token);
					},
					success : function(data) {
						console.log(data);

						if (data) {
							var productOrderList      = data.productOrderList.content,
									productOrderPagingDto = data.productOrderPagingDto,
									$productOrderTableBody = $(".order-table-body"),
									$productOrderPagination = $(".product-order-pagination");

							$productOrderTableBody.empty();
							$productOrderPagination.empty();

							if (productOrderList.length > 0) {

								productOrderList.forEach(function(element) {

									var cartListLength = element.carts.length;

									var orderTr = "<tr class='cart_itme'>" +
											"<td class=\"product-remove\"><a data-order-id='" + element.id + "' data-toggle=\"modal\" data-target=\".bs-order-modal-lg\" title=\"Remove this item\" class=\"remove\" href=\"#\" onclick='orderObj.getOrderDetail(this)'>" + element.orderNumber + "</a></td>" +
											"<td class=\"product-thumbnail\"><a href='/productDetails?productId=" + element.carts[cartListLength - 1].product.id + "'><img alt=\"member\" src='" + element.carts[cartListLength - 1].product.titleImg + "'></a></td>" +
											"<td class=\"product-name\"><span class=\"text-theme-colored\">" + element.orderName + "<span/>" +
											"<ul class=\"variation\">" +
											"</ul></td>" +
											"<td class=\"product-price\"><span class=\"amount\">" + element.amount + "</span></td>" +
											"<td class=\"product-price\"><span class=\"amount\">" + element.orderStatus + "</span></td>" +
											"<td class=\"product-name\"><span class=\"amount\">" + element.createdDate + "</span></td>" +
											"</tr>"

									$productOrderTableBody.append(orderTr);
								})

								// 페이징 그리기
								// Prev 페이지
								if (productOrderPagingDto.scaleStartPage !== 1) {
									var prevLi =
											"<li><a data-page='" + productOrderPagingDto.prePage + "' class='product-list-page' href='#' onclick='orderObj.getOrderList(this)' aria-label='Previous'><span aria-hidden='true'>&laquo;</span></a></li>";

									$productOrderPagination.append(prevLi);
								}

								// 중간 페이지
								for (var i = productOrderPagingDto.scaleStartPage; i <= productOrderPagingDto.scaleEndPage; i++) {
									var pageLi = "";

									if (productOrderPagingDto.page === i) {
										pageLi = "<li class='active'><a data-page='" + i + "' class='product-list-page' href='#' onclick='orderObj.getOrderList(this)'>" + i + "</a></li>";
									} else {
										pageLi = "<li class=''><a data-page='" + i + "' class='product-list-page' href='#' onclick='orderObj.getOrderList(this)'>" + i + "</a></li>";
									}

									$productOrderPagination.append(pageLi);
								}

								// Next 페이지
								if (productOrderPagingDto.scaleEndPage !== productOrderPagingDto.totPage) {
									var nextLi =
											"<li><a data-page='" + productOrderPagingDto.nextPage + "' class='product-list-page' href='#' onclick='orderObj.getOrderList(this)' aria-label='Next'><span aria-hidden='true'>&raquo;</span></a></li>"

									$productOrderPagination.append(nextLi);
								}
							}
						}


					},
					error   : function(e) {
						alert(e.responseText);
					}
				})
			},
			getOrderDetail  : function (obj) {

				$.ajax({
					type : "GET",
					url : "/order/" + $(obj).data("orderId"),
					contentType : "application/json",
					beforeSend	: function(xhr) {
						xhr.setRequestHeader(header, token);
					},
					success : function(data) {
						var $orderUl = $(".order-ul");

						$orderUl.empty();

						var orderLi = "<li><strong>주문번호</strong></li>" +
								"<li>" + data.order_num + "</li><hr>" +
								"<li><strong>주문명</strong></li>" +
								"<li>" + data.order_name + "</li><hr>" +
								"<li><strong>결제금액</strong></li>" +
								"<li>" + data.amount + "원</li><hr>" +
								"<li><strong>주문상태</strong></li>" +
								"<li>" + data.order_status + "</li><hr>" +
								"<li><strong>배송주소</strong></li>" +
								"<li>" + data.address + "</li><hr>" +
								"<li><strong>배송메세지</strong></li>" +
								"<li>" + data.message + "</li><hr>" +
								"<li><strong>주문상품 (최대 16개 까지만 표시됩니다.)</strong></li>";

						for (var i = 0; i < data.carts.length; i++) {
							orderLi += "<img width='100px' height='100px' alt=\"member\" src='" + data.cart[i].product.titl_img + "'>";

							if (i === 15) {
								orderLi += "<hr><li>외 " + (data.cart.length - (i + 1)) + "종류의 상품</li>"
								break;
							}
						}

						$orderUl.append(orderLi);
					},
					error : function (e) {
						alert(e.responseText);
					}
				})

			}
		}

		$(function() {
			orderObj.getOrderList();
		})
	</script>
	<!-- Section -->
	<section>
		<header class="main">
			<h2>ORDER</h2>
		</header>
		<form action="" method="post">
			<div class="table-wrapper">
				<h4>주문상품</h4>
				<table>
					<tbody>
					<tr>
						<td>
							<span class="image left">
								<img src="images/pic01.jpg" alt="">
							</span>
							웅앵커피<br>
						</td>
						<td>X 1</td>
						<td>12,000</td>
					</tr>
					</tbody>
				</table>
			</div>
			<h4>배송정보</h4>
			<div class="table-wrapper">
				<table>
					<tr>
						<td class="col-6 col-12-xsmall">
							<label for="rec">받는 분</label>
							<input type="text" name="rec" id="rec">
						</td>
						<td>
							<input type="text" value="" placeholder="이름">
						</td>
					</tr>
					<tr>
						<td class="col-6 col-12-xsmall">
							<label for="phone">휴대전화</label>
							<input type="text" name="phone" id="phone">
						</td>
						<td>
						<input type="text" value="" placeholder="휴대전화">
						</td>
					</tr>

<!--					<tr>
						<td class="col-2 col-12-xsmall">
							<label for="email">이메일</label>
						</td>
						<td>
							<input type="email" value="" placeholder="이메일">
						</td>
					</tr>-->
					<tr>
						<td class="col-2 col-12-xsmall">
							<label for="postCode">주소</label>
							<input type="text" name="postCode" id="postCode" placeholder="우편번호">
							<input type="button" onclick="execDaumPostcode()" value="우편번호 찾기"><br>
							<input type="text" name="address" id="address" placeholder="주소">
							<input type="text" name="de_address" id="de_address" placeholder="상세주소">
							<input type="text" id="extraAddress" class="d_form" placeholder="참고항목">
							<div id="wrap" style="display: none; border: 1px solid; width: 500px; height: 466px; margin: 5px 0px; position: relative;">
								<img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnFoldWrap" style="cursor: pointer; position: absolute; right: 0px; top:-1px; z-index:1" onclick="foldDaumPostcode()" alt="접기 버튼">
							</div>
						</td>
					</tr>
					<tr>
						<td class="col-2 col-12-xsmall">
							<label for="demo-message">배송 메시지</label>
							<textarea id="demo-message" placeholder="배송기사님께 전달할 메시지입니다" rows="2"></textarea>
						</td>
					</tr>-
				</table>
			</div>
			<div class="table-wrapper">
				<table>
					<thead>
					<tr>
						<th>결제</th>
					</tr>
					</thead>
					<tbody>
					<tr>
						<td>
							<input type="radio"><label>신용카드</label>
							<input type="radio"><label>계좌이체</label>
							<input type="radio"><label>휴대폰</label>
							<input type="radio"><label>무통장입금</label>
						</td>
					</tr>
					</tbody>
				</table>
			</div>
			<div class="table-wrapper">
				<table>
					<tr>
						<td class="">상품금액</td><td class="">12,000 원</td>
					</tr>
					<tr>
						<td class="">배송비</td><td class="">2,500 원</td>
					</tr>
					<tr>
						<td class="">결제예정</td><td class="">14,500 원</td>
					</tr>
				</table>
			</div>
			<button type="submit" class="orderBtn primary">주문</button>
			<button type="button" class="button cancelBtn"></button>
		</form>
	</section>
</th:layout>
</html>