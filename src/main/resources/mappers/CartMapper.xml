<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.intea.mapper.CartMapper">

    <sql id="cartColumns">
        i_mem, i_product, count, insert_time, delete_yn
    </sql>

    <resultMap id="cartMap" type="CartEntity">
        <id property="i_cart" column="i_cart"/>
        <result property="i_mem" column="i_mem"/>
        <result property="i_product" column="i_product"/>
        <result property="count" column="count"/>
        <result property="delete_yn" column="delete_yn"/>
        <result property="insert_time" column="insert_time"/>
        <result property="update_time" column="update_time"/>
    </resultMap>

    <!-- 카드 비우기 -->
    <delete id="cartAllDel">
        UPDATE cart
        SET delete_yn = 'Y'
        WHERE i_mem = #{i_mem}
    </delete>

            <!-- 장바구니 담기 -->
    <insert id="insCart" parameterType="CartEntity">
    INSERT INTO cart (
    <include refid="cartColumns"/>
    ) VALUES (
    #{i_mem}, #{i_product}, #{count}, NOW(), 'N'
    )
    </insert>

            <!-- 장바구니 수정 -->
    <update id="updCart" parameterType="CartEntity">
    UPDATE cart
    SET count = #{count}
    WHERE delete_yn = 'N'
    AND i_cart = #{i_cart}
    </update>

            <!-- 삭제 -->
    <update id="delCart" parameterType="CartEntity">
    UPDATE cart
    SET delete_yn = 'Y'
    WHERE i_cart = #{i_cart}
    AND i_mem = #{i_mem}
    </update>

            <!-- 리스트 -->
    <select id="selCartList" resultMap="cartMap">
    SELECT
    p.p_nm, p.price, c.count
    FROM cart c
    INNER JOIN product p
    ON c.i_product = p.i_product
    WHERE c.i_mem = #{i_mem}
    </select>

</mapper>