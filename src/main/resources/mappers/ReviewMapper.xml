<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.intea.mapper.ReviewMapper">
    <sql id="reviewColumns">
        i_board, i_mem, title, content, view_cnt, delete_yn, insert_time, update_time, delete_time
    </sql>

    <sql id="insReviewColumns">
        i_mem, title, content, view_cnt, delete_yn, insert_time, update_time, delete_time
    </sql>

    <insert id="insReview" useGeneratedKeys="true" keyProperty="i_board">
        INSERT INTO review (
            <include refid="insReviewColumns"/>
        ) VALUES (
            #{i_mem}, #{title},  #{content}, 0, 'N'), 'N', NOW(), NULL, NULL
        )
    </insert>

    <select id="selReviewDetail" resultType="BoardDTO">
        SELECT
            <include refid="reviewColumns"/>
        FROM review
        WHERE delete_yn = 'N'
        AND i_board = #{i_board}
    </select>

    <select id="selReviewListOfProduct" resultType="BoardDTO">
        SELECT
        <include refid="reviewColumns"/>
        FROM review
        WHERE delete_yn = 'N' AND i_product = #{i_product}
        ORDER BY i board DESC, insert_time DESC
        <include refid="CommonMapper.search"/>
    </select>

    <select id="selReviewList" resultType="BoardDTO">
        SELECT
        <include refid="reviewColumns"/>
        FROM review
        WHERE delete_yn = 'N'
        <include refid="CommonMapper.search"/>
        ORDER BY
        i_board DESC,
        insert_time DESC
        <include refid="CommonMapper.paging"/>
    </select>

    <select id="selReviewTotalCnt" resultType="int">
        SELECT COUNT(*)
        FROM review
        WHERE delete_yn = 'N'
        <include refid="CommonMapper.search"/>
    </select>

    <select id="selReviewCnt" resultType="int">
        SELECT COUNT(*)
        FROM review
        WHERE delete_yn = 'N' AND i_product = #{i_product}
        <include refid="CommonMapper.search"/>
    </select>
    <update id="updReview">
        UPDATE review
        SET
            update_time = NOW()
            , title = #{title}
            , content = #{content}
        WHERE
            i_board = #{i_board}
    </update>

    <update id="delReview" parameterType="long">
        UPDATE review
        SET delete_yn = 'Y'
          , delete_time = NOW()
        WHERE
              i_board = #{i_board}
    </update>
</mapper>